close
clear
clc

%%      Figure 5 is generated by R (code name: A_Figure5_2.R)
%        Please run the following Matlab code first. (Some results are generated by this code and saved to the R code folder.)
%        Then run the R code 'A_Figure5_2.R'.

load shenwan
load hushen
load Adjacency
%  ----------------------- networks on 2019/2/25 and 2020/2/3 ---------------------------------------------
% The network figure need to be finished by R
% This is the input of this figure.
[T,N] = size(shenwan);
[y,p] = sort(hushen(1401:end));
y(end);
netmat1 = Adjacency(:,:,p(end)); % 2019/2/25 (820)   good
posnet = []; negnet = []; zeronet = [];
for i = 1:N
    for j = 1:N
        if i<j
            if netmat1(i,j) == 1
                posnet0 = [i,j,1];
                posnet = [posnet;posnet0];
            else if netmat1(i,j) == -1
                    negnet0 = [i,j,2];
                    negnet = [negnet;negnet0];
                else
                    zeronet0 = [i,j,0];
                    zeronet = [zeronet;zeronet0];
                end
            end
        end
    end
end
sysriskgood0 = [posnet;negnet];
sum(sysriskgood0(:,3)==1);
sum(sysriskgood0(:,3)==2);

y(1);
netmat2 = Adjacency(:,:,p(1));%2020/2/3 (1047)  bad
posnet = []; negnet = []; zeronet = [];
for i = 1:N
    for j = 1:N
        if i<j
            if netmat2(i,j) == 1
                posnet0 = [i,j,1];
                posnet = [posnet;posnet0];
            else if netmat2(i,j) == -1
                    negnet0 = [i,j,2];
                    negnet = [negnet;negnet0];
                else
                    zeronet0 = [i,j,0];
                    zeronet = [zeronet;zeronet0];
                end
            end
        end
    end
end

sysriskbad0 = [posnet;negnet];
sum(sysriskbad0(:,3)==1);
sum(sysriskbad0(:,3)==2);
sysriskbad0 = cat(2,sysriskbad0,ones(size(sysriskbad0,1),1));
A=strings(size(sysriskbad0));
for i = 1:size(sysriskbad0,1)
    for j = 1:2
        if sysriskbad0(i,j)<10
            A(i,j) = strcat('s0',num2str(sysriskbad0(i,j)));
        else
            A(i,j) = strcat('s',num2str(sysriskbad0(i,j)));
        end
    end
end
for i = 1:size(sysriskbad0,1)
    for j = 3:4
        A(i,j) = num2str(sysriskbad0(i,j));
    end
end
col = {'from','to',	'type','weight'};
sysriskbad = cat(1,col,A);
cell2csv('E:\software\R\code\CoVaRCoes\sysriskbad.csv', sysriskbad);

sysriskgood0 = cat(2,sysriskgood0,ones(size(sysriskgood0,1),1));
A=strings(size(sysriskgood0));
for i = 1:size(sysriskgood0,1)
    for j = 1:2
        if sysriskgood0(i,j)<10
            A(i,j) = strcat('s0',num2str(sysriskgood0(i,j)));
        else
            A(i,j) = strcat('s',num2str(sysriskgood0(i,j)));
        end
    end
end
for i = 1:size(sysriskgood0,1)
    for j = 3:4
        A(i,j) = num2str(sysriskgood0(i,j));
    end
end
col = {'from','to',	'type','weight'};
sysriskgood = cat(1,col,A);
cell2csv('E:\software\R\code\CoVaRCoes\sysriskgood.csv', sysriskgood);


