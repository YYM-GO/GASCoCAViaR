close
clear
clc

%%
%        Table 3 colume 1-6 is generated the this Matlab code. (The final contents of the table are summarized in lines 395–405.)
%        Table 3 column 7-8 is generated by R (code name: A_Table3_2.R)
%        Please run the following Matlab code first.  (Some results are generated by this code, and saved to the R code folder)
%        Then run the R code 'A_Table3_2.R'.

%============================================= Industries → System =================================================================
load hushen
load shenwan
load VaRNormali2s
load VaRPOTi2s

load CoESfullGauASi2s
load CoESfullGauSAVi2s
load CoESfullPOTASi2s
load CoESfullPOTSAVi2s

load CoVaRfullGauASi2s
load CoVaRfullGauSAVi2s
load CoVaRfullPOTASi2s
load CoVaRfullPOTSAVi2s

load CoESfullGauASi2sc
load CoESfullGauSAVi2sc
load CoESfullPOTASi2sc
load CoESfullPOTSAVi2sc

load CoVaRfullGauASi2sc
load CoVaRfullGauSAVi2sc
load CoVaRfullPOTASi2sc
load CoVaRfullPOTSAVi2sc

load DCCCoESi2sGaufull
load DCCCoVaRi2sGaufull
load DCCVaRi2sGaufull

load DCCCoESi2sPOTfull
load DCCCoVaRi2sPOTfull
load DCCVaRi2sPOTfull

load CopulaVaRi2sGaufull
load CopulaCoVaRi2sGaufull
load CopulaCoESi2sGaufull

load CopulaVaRi2sPOTfull
load CopulaCoVaRi2sPOTfull
load CopulaCoESi2sPOTfull

[T,N] = size(shenwan);

THETA1 = 0.05; THETA2 = 0.05; %probability level for VaR and CoVaR

THETA1test = 1-THETA1;
THETA2test = 1-THETA2;

GauSAVVaR = -VaRNormali2s; GauSAVCoVaR = CoVaRfullGauSAVi2s; GauSAVCoES = CoESfullGauSAVi2s;
POTSAVVaR = -VaRPOTi2s; POTSAVCoVaR = CoVaRfullPOTSAVi2s; POTSAVCoES = CoESfullPOTSAVi2s;
GauASVaR = -VaRNormali2s; GauASCoVaR = CoVaRfullGauASi2s; GauASCoES = CoESfullGauASi2s;
POTASVaR = -VaRPOTi2s; POTASCoVaR = CoVaRfullPOTASi2s; POTASCoES = CoESfullPOTASi2s;

GauSAVVaRc = -VaRNormali2s; GauSAVCoVaRc = CoVaRfullGauSAVi2sc; GauSAVCoESc = CoESfullGauSAVi2sc;
POTSAVVaRc = -VaRPOTi2s; POTSAVCoVaRc = CoVaRfullPOTSAVi2sc; POTSAVCoESc = CoESfullPOTSAVi2sc;
GauASVaRc = -VaRNormali2s; GauASCoVaRc = CoVaRfullGauASi2sc; GauASCoESc = CoESfullGauASi2sc;
POTASVaRc = -VaRPOTi2s; POTASCoVaRc = CoVaRfullPOTASi2sc; POTASCoESc = CoESfullPOTASi2sc;
DCCgauVaR = -DCCVaRi2sGaufull; DCCgauCoVaR = -DCCCoVaRi2sGaufull; DCCgauCoES = -DCCCoESi2sGaufull;
DCCPOTVaR = -DCCVaRi2sPOTfull; DCCPOTCoVaR = -DCCCoVaRi2sPOTfull; DCCPOTCoES = -DCCCoESi2sPOTfull;
copulagauVaR = -CopulaVaRi2sGaufull; copulagauCoVaR = -CopulaCoVaRi2sGaufull; copulagauCoES = -CopulaCoESi2sGaufull;
copulaPOTVaR = -CopulaVaRi2sPOTfull; copulaPOTCoVaR = -CopulaCoVaRi2sPOTfull; copulaPOTCoES = -CopulaCoESi2sPOTfull;

for i = 1:N
    HitcovarGauSAV(i) = sum((shenwan(:,i)<-GauSAVVaR(:,i)).*(hushen<-GauSAVCoVaR(:,i)))/sum(shenwan(:,i)<-GauSAVVaR(:,i));
    HitcovarGauAS(i) = sum((shenwan(:,i)<-GauASVaR(:,i)).*(hushen<-GauASCoVaR(:,i)))/sum(shenwan(:,i)<-GauASVaR(:,i));
    HitcoVaRPOTi2sSAV(i) = sum((shenwan(:,i)<-POTSAVVaR(:,i)).*(hushen<-POTSAVCoVaR(:,i)))/sum(shenwan(:,i)<-POTSAVVaR(:,i));
    HitcoVaRPOTi2sAS(i) = sum((shenwan(:,i)<-POTASVaR(:,i)).*(hushen<-POTASCoVaR(:,i)))/sum(shenwan(:,i)<-POTASVaR(:,i));
    HitcovarGauSAVc(i) = sum((shenwan(:,i)<-GauSAVVaRc(:,i)).*(hushen<-GauSAVCoVaRc(:,i)))/sum(shenwan(:,i)<-GauSAVVaRc(:,i));
    HitcovarGauASc(i) = sum((shenwan(:,i)<-GauASVaRc(:,i)).*(hushen<-GauASCoVaRc(:,i)))/sum(shenwan(:,i)<-GauASVaRc(:,i));
    HitcoVaRPOTi2sSAVc(i) =sum((shenwan(:,i)<-POTSAVVaRc(:,i)).*(hushen<-POTSAVCoVaRc(:,i)))/sum(shenwan(:,i)<-POTSAVVaRc(:,i));
    HitcoVaRPOTi2sASc(i) = sum((shenwan(:,i)<-POTASVaRc(:,i)).*(hushen<-POTASCoVaRc(:,i)))/sum(shenwan(:,i)<-POTASVaRc(:,i));
    HitcovarGumgarchg(i) = sum((shenwan(:,i)<-copulagauVaR(:,i,1)).*(hushen<-copulagauCoVaR(:,i,1)))/sum(shenwan(:,i)<-copulagauVaR(:,i,1));
    HitcovarTgarchg(i) = sum((shenwan(:,i)<-copulagauVaR(:,i,2)).*(hushen<-copulagauCoVaR(:,i,2)))/sum(shenwan(:,i)<-copulagauVaR(:,i,2));
    HitcovarGausgarchg(i) = sum((shenwan(:,i)<-copulagauVaR(:,i,3)).*(hushen<-copulagauCoVaR(:,i,3)))/sum(shenwan(:,3)<-copulagauVaR(:,i,3));
    HitcovarClaygarchg(i) = sum((shenwan(:,i)<-copulagauVaR(:,i,4)).*(hushen<-copulagauCoVaR(:,i,4)))/sum(shenwan(:,i)<-copulagauVaR(:,i,4));
    HitcovarGumgarchP(i) = sum((shenwan(:,i)<-copulaPOTVaR(:,i,1)).*(hushen<-copulaPOTCoVaR(:,i,1)))/sum(shenwan(:,i)<-copulaPOTVaR(:,i,1));
    HitcovarTgarchP(i) = sum((shenwan(:,i)<-copulaPOTVaR(:,i,2)).*(hushen<-copulaPOTCoVaR(:,i,2)))/sum(shenwan(:,i)<-copulaPOTVaR(:,i,2));
    HitcovarGausgarchP(i) = sum((shenwan(:,i)<-copulaPOTVaR(:,i,3)).*(hushen<-copulaPOTCoVaR(:,i,3)))/sum(shenwan(:,i)<-copulaPOTVaR(:,i,3));
    HitcovarClaygarchP(i) = sum((shenwan(:,i)<-copulaPOTVaR(:,i,4)).*(hushen<-copulaPOTCoVaR(:,i,4)))/sum(shenwan(:,i)<-copulaPOTVaR(:,i,4));
    HitcovarDCCg(i) = sum((shenwan(:,i)<-DCCgauVaR(:,i)).*(hushen<-DCCgauCoVaR(:,i)))/sum(shenwan(:,i)<-DCCgauVaR(:,i));
    HitcovarDCCP(i) = sum((shenwan(:,i)<-DCCPOTVaR(:,i)).*(hushen<-DCCPOTCoVaR(:,i)))/sum(shenwan(:,i)<-DCCPOTVaR(:,i));
end
hitcovg= [HitcovarGauSAV',HitcovarGauAS',HitcovarGauSAVc',HitcovarGauASc',HitcovarGausgarchg',HitcovarTgarchg',HitcovarClaygarchg',HitcovarGumgarchg',HitcovarDCCg'];
Ai2s_1 = [mean(hitcovg)*100]';
hitcovP= [HitcoVaRPOTi2sSAV',HitcoVaRPOTi2sAS',HitcoVaRPOTi2sSAVc',HitcoVaRPOTi2sASc',HitcovarGausgarchP',HitcovarTgarchP',HitcovarClaygarchP',HitcovarGumgarchP',HitcovarDCCP'];
Bi2s_1 = [mean(hitcovP)*100]';

for i = 1:N
    cccovarGauSAV(i) = cccovar(shenwan(:,i),-GauSAVVaR(:,i),hushen,-GauSAVCoVaR(:,i),THETA2);
    cccovarGauAS(i) = cccovar(shenwan(:,i),-GauASVaR(:,i),hushen,-GauASCoVaR(:,i),THETA2);
    cccovarPOTSAV(i) = cccovar(shenwan(:,i),-POTSAVVaR(:,i),hushen,-POTSAVCoVaR(:,i),THETA2);
    cccovarPOTAS(i) = cccovar(shenwan(:,i),-POTASVaR(:,i),hushen,-POTASCoVaR(:,i),THETA2);
    cccovarGauSAVc(i) = cccovar(shenwan(:,i),-GauSAVVaRc(:,i),hushen,-GauSAVCoVaRc(:,i),THETA2);
    cccovarGauASc(i) = cccovar(shenwan(:,i),-GauASVaRc(:,i),hushen,-GauASCoVaRc(:,i),THETA2);
    cccovarPOTSAVc(i) = cccovar(shenwan(:,i),-POTSAVVaRc(:,i),hushen,-POTSAVCoVaRc(:,i),THETA2);
    cccovarPOTASc(i) = cccovar(shenwan(:,i),-POTASVaRc(:,i),hushen,-POTASCoVaRc(:,i),THETA2);
    cccovarGumgarchg(i) = cccovar(shenwan(:,i),-copulagauVaR(:,i,1),hushen,-copulagauCoVaR(:,i,1),THETA2);
    cccovarTgarchg(i) = cccovar(shenwan(:,i),-copulagauVaR(:,i,2),hushen,-copulagauCoVaR(:,i,2),THETA2);
    cccovarGausgarchg(i) = cccovar(shenwan(:,i),-copulagauVaR(:,i,3),hushen,-copulagauCoVaR(:,i,3),THETA2);
    cccovarClaygarchg(i) = cccovar(shenwan(:,i),-copulagauVaR(:,i,4),hushen,-copulagauCoVaR(:,i,4),THETA2);
    cccovarGumgarchP(i) = cccovar(shenwan(:,i),-copulaPOTVaR(:,i,1),hushen,-copulaPOTCoVaR(:,i,1),THETA2);
    cccovarTgarchP(i) = cccovar(shenwan(:,i),-copulaPOTVaR(:,i,2),hushen,-copulaPOTCoVaR(:,i,2),THETA2);
    cccovarGausgarchP(i) = cccovar(shenwan(:,i),-copulaPOTVaR(:,i,3),hushen,-copulaPOTCoVaR(:,i,3),THETA2);
    cccovarClaygarchP(i) = cccovar(shenwan(:,i),-copulaPOTVaR(:,i,4),hushen,-copulaPOTCoVaR(:,i,4),THETA2);
    cccovarDCCg(i) = cccovar(shenwan(:,i),-DCCgauVaR(:,i),hushen,-DCCgauCoVaR(:,i),THETA2);
    cccovarDCCP(i) = cccovar(shenwan(:,i),-DCCPOTVaR(:,i),hushen,-DCCPOTCoVaR(:,i),THETA2);
end
cccovg= real([cccovarGauSAV',cccovarGauAS',cccovarGauSAVc',cccovarGauASc',cccovarGausgarchg',cccovarTgarchg',cccovarClaygarchg',cccovarGumgarchg',cccovarDCCg']);
cccovP= real([cccovarPOTSAV',cccovarPOTAS',cccovarPOTSAVc',cccovarPOTASc',cccovarGausgarchP',cccovarTgarchP',cccovarClaygarchP',cccovarGumgarchP',cccovarDCCP']);
Ai2s_23 = [sum(cccovg>0.05)',sum(cccovg>0.1)'];
Bi2s_23 = [sum(cccovP>0.05)',sum(cccovP>0.1)'];
for i = 1:N
    uccovarGauSAV(i) = uccovar(shenwan(:,i),-GauSAVVaR(:,i),hushen,-GauSAVCoVaR(:,i),THETA2);
    uccovarGauAS(i) = uccovar(shenwan(:,i),-GauASVaR(:,i),hushen,-GauASCoVaR(:,i),THETA2);
    uccovarPOTSAV(i) = uccovar(shenwan(:,i),-POTSAVVaR(:,i),hushen,-POTSAVCoVaR(:,i),THETA2);
    uccovarPOTAS(i) = uccovar(shenwan(:,i),-POTASVaR(:,i),hushen,-POTASCoVaR(:,i),THETA2);
    uccovarGauSAVc(i) = uccovar(shenwan(:,i),-GauSAVVaRc(:,i),hushen,-GauSAVCoVaRc(:,i),THETA2);
    uccovarGauASc(i) = uccovar(shenwan(:,i),-GauASVaRc(:,i),hushen,-GauASCoVaRc(:,i),THETA2);
    uccovarPOTSAVc(i) = uccovar(shenwan(:,i),-POTSAVVaRc(:,i),hushen,-POTSAVCoVaRc(:,i),THETA2);
    uccovarPOTASc(i) = uccovar(shenwan(:,i),-POTASVaRc(:,i),hushen,-POTASCoVaRc(:,i),THETA2);
    uccovarGumgarchg(i) = uccovar(shenwan(:,i),-copulagauVaR(:,i,1),hushen,-copulagauCoVaR(:,i,1),THETA2);
    uccovarTgarchg(i) = uccovar(shenwan(:,i),-copulagauVaR(:,i,2),hushen,-copulagauCoVaR(:,i,2),THETA2);
    uccovarGausgarchg(i) = uccovar(shenwan(:,i),-copulagauVaR(:,i,3),hushen,-copulagauCoVaR(:,i,3),THETA2);
    uccovarClaygarchg(i) = uccovar(shenwan(:,i),-copulagauVaR(:,i,4),hushen,-copulagauCoVaR(:,i,4),THETA2);
    uccovarGumgarchP(i) = uccovar(shenwan(:,i),-copulaPOTVaR(:,i,1),hushen,-copulaPOTCoVaR(:,i,1),THETA2);
    uccovarTgarchP(i) = uccovar(shenwan(:,i),-copulaPOTVaR(:,i,2),hushen,-copulaPOTCoVaR(:,i,2),THETA2);
    uccovarGausgarchP(i) = uccovar(shenwan(:,i),-copulaPOTVaR(:,i,3),hushen,-copulaPOTCoVaR(:,i,3),THETA2);
    uccovarClaygarchP(i) = uccovar(shenwan(:,i),-copulaPOTVaR(:,i,4),hushen,-copulaPOTCoVaR(:,i,4),THETA2);
    uccovarDCCg(i) = uccovar(shenwan(:,i),-DCCgauVaR(:,i),hushen,-DCCgauCoVaR(:,i),THETA2);
    uccovarDCCP(i) = uccovar(shenwan(:,i),-DCCPOTVaR(:,i),hushen,-DCCPOTCoVaR(:,i),THETA2);
end
uccovg= [uccovarGauSAV',uccovarGauAS',uccovarGauSAVc',uccovarGauASc',uccovarGausgarchg',uccovarTgarchg',uccovarClaygarchg',uccovarGumgarchg',uccovarDCCg'];
uccovP= [uccovarPOTSAV',uccovarPOTAS',uccovarPOTSAVc',uccovarPOTASc',uccovarGausgarchP',uccovarTgarchP',uccovarClaygarchP',uccovarGumgarchP',uccovarDCCP'];
Ai2s_45 = [sum(uccovg>0.05)',sum(uccovg>0.1)'];
Bi2s_45 = [sum(uccovP>0.05)',sum(uccovP>0.1)'];
for t = 1:T
    for i = 1:N
        SCoVaRGauSAV(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),GauSAVVaR(t,i),GauSAVCoVaR(t,i),THETA1test);
        SCoVaRGauAS(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),GauASVaR(t,i),GauASCoVaR(t,i),THETA1test);
        SCoVaRPOTSAV(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),POTSAVVaR(t,i),POTSAVCoVaR(t,i),THETA1test);
        SCoVaRPOTAS(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),POTASVaR(t,i),POTASCoVaR(t,i),THETA1test);
        SCoVaRGauSAVc(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),GauSAVVaRc(t,i),GauSAVCoVaRc(t,i),THETA1test);
        SCoVaRGauASc(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),GauASVaRc(t,i),GauASCoVaRc(t,i),THETA1test);
        SCoVaRPOTSAVc(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),POTSAVVaRc(t,i),POTSAVCoVaRc(t,i),THETA1test);
        SCoVaRPOTASc(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),POTASVaRc(t,i),POTASCoVaRc(t,i),THETA1test);
        SCoVaRGumg(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulagauVaR(t,i,1),copulagauCoVaR(t,i,1),THETA1test);
        SCoVaRTg(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulagauVaR(t,i,2),copulagauCoVaR(t,i,2),THETA1test);
        SCoVaRGausg(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulagauVaR(t,i,3),copulagauCoVaR(t,i,3),THETA1test);
        SCoVaRClayg(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulagauVaR(t,i,4),copulagauCoVaR(t,i,4),THETA1test);
        SCoVaRGumP(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulaPOTVaR(t,i,1),copulaPOTCoVaR(t,i,1),THETA1test);
        SCoVaRTP(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulaPOTVaR(t,i,2),copulaPOTCoVaR(t,i,2),THETA1test);
        SCoVaRGausP(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulaPOTVaR(t,i,3),copulaPOTCoVaR(t,i,3),THETA1test);
        SCoVaRClayP(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),copulaPOTVaR(t,i,4),copulaPOTCoVaR(t,i,4),THETA1test);
        SCoVaRDCCg(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),DCCgauVaR(t,i),DCCgauCoVaR(t,i),THETA1test);
        SCoVaRDCCP(t,i) = SCoVaR2(-shenwan(t,i),-hushen(t),DCCPOTVaR(t,i),DCCPOTCoVaR(t,i),THETA1test);
    end
end
Ai2s_6 = mean([mean(squeeze(SCoVaRGauSAV(:,:)));mean(squeeze(SCoVaRGauAS(:,:)));mean(squeeze(SCoVaRGauSAVc(:,:)));mean(squeeze(SCoVaRGauASc(:,:)));...
    mean(squeeze(SCoVaRGausg(:,:)));mean(squeeze(SCoVaRTg(:,:)));mean(squeeze(SCoVaRClayg(:,:)));mean(squeeze(SCoVaRGumg(:,:)));mean(squeeze(SCoVaRDCCg(:,:)))]*100,2);
Bi2s_6 = mean([mean(squeeze(SCoVaRPOTSAV(:,:)));mean(squeeze(SCoVaRPOTAS(:,:)));mean(squeeze(SCoVaRPOTSAVc(:,:)));mean(squeeze(SCoVaRPOTASc(:,:)));...
    mean(squeeze(SCoVaRGausP(:,:)));mean(squeeze(SCoVaRTP(:,:)));mean(squeeze(SCoVaRClayP(:,:)));mean(squeeze(SCoVaRGumP(:,:)));mean(squeeze(SCoVaRDCCP(:,:)))]*100,2);
GauAL = cat(3,SCoVaRGauSAV,SCoVaRGauAS,SCoVaRGauSAVc,SCoVaRGauASc,SCoVaRGausg,SCoVaRTg,SCoVaRClayg,SCoVaRGumg,SCoVaRDCCg);
GauALall = [];
for i = 1:N
    GauALall = cat(2,GauALall,squeeze(GauAL(:,i,:)));
end
col = {'SAV','AS','SAVc','ASc','C-Gau','C-T','C-Clay','C-RGum','DCC'};
colall = [];
for i = 1:N
    for j = 1:9
        colall = cat(2,colall,strcat(col(j),num2str(i)));
    end
end
columns = repmat(col,1,31);
data = array2table(GauALall,'VariableNames',colall);
writetable(data, 'E:\software\R\code\CoVaRCoes\Gaui2sfullCoVaR.csv');
POTAL = cat(3,SCoVaRPOTSAV,SCoVaRPOTAS,SCoVaRPOTSAVc,SCoVaRPOTASc,SCoVaRGausP,SCoVaRTP,SCoVaRClayP,SCoVaRGumP,SCoVaRDCCP);
POTALall = [];
for i = 1:N
    POTALall = cat(2,POTALall,squeeze(POTAL(:,i,:)));
end
col = {'SAV','AS','SAVc','ASc','C-Gau','C-T','C-Clay','C-RGum','DCC'};
colall = [];
for i = 1:N
    for j = 1:9
        colall = cat(2,colall,strcat(col(j),num2str(i)));
    end
end
columns = repmat(col,1,31);
data = array2table(POTALall,'VariableNames',colall);
writetable(data, 'E:\software\R\code\CoVaRCoes\POTi2sfullCoVaR.csv');

%====================================================  System → Industries  ====================================================================================================
load VaRNormals2i
load VaRPOTs2i

load CoESfullGauASs2i
load CoESfullGauSAVs2i
load CoESfullPOTASs2i
load CoESfullPOTSAVs2i

load CoVaRfullGauASs2i
load CoVaRfullGauSAVs2i
load CoVaRfullPOTASs2i
load CoVaRfullPOTSAVs2i

load CoESfullGauASs2ic
load CoESfullGauSAVs2ic
load CoESfullPOTASs2ic
load CoESfullPOTSAVs2ic

load CoVaRfullGauASs2ic
load CoVaRfullGauSAVs2ic
load CoVaRfullPOTASs2ic
load CoVaRfullPOTSAVs2ic

load DCCCoESs2iGaufull
load DCCCoVaRs2iGaufull
load DCCVaRs2iGaufull

load DCCCoESs2iPOTfull
load DCCCoVaRs2iPOTfull
load DCCVaRs2iPOTfull

load CopulaVaRs2iGaufull
load CopulaCoVaRs2iGaufull
load CopulaCoESs2iGaufull

load CopulaVaRs2iPOTfull
load CopulaCoVaRs2iPOTfull
load CopulaCoESs2iPOTfull

[T,N] = size(shenwan);

THETA1 = 0.05; THETA2 = 0.05; %probability level for VaR and CoVaR

THETA1test = 1-THETA1;
THETA2test = 1-THETA2;

GauSAVVaR = repmat(-VaRNormals2i,1,N); GauSAVCoVaR = CoVaRfullGauSAVs2i; GauSAVCoES = CoESfullGauSAVs2i;
POTSAVVaR = repmat(-VaRPOTs2i,1,N); POTSAVCoVaR = CoVaRfullPOTSAVs2i; POTSAVCoES = CoESfullPOTSAVs2i;
GauASVaR = repmat(-VaRNormals2i,1,N); GauASCoVaR = CoVaRfullGauASs2i; GauASCoES = CoESfullGauASs2i;
POTASVaR = repmat(-VaRPOTs2i,1,N); POTASCoVaR = CoVaRfullPOTASs2i; POTASCoES = CoESfullPOTASs2i;
GauSAVVaRc = repmat(-VaRNormals2i,1,N); GauSAVCoVaRc = CoVaRfullGauSAVs2ic; GauSAVCoESc = CoESfullGauSAVs2ic;
POTSAVVaRc = repmat(-VaRPOTs2i,1,N); POTSAVCoVaRc = CoVaRfullPOTSAVs2ic; POTSAVCoESc = CoESfullPOTSAVs2ic;
GauASVaRc = repmat(-VaRNormals2i,1,N); GauASCoVaRc = CoVaRfullGauASs2ic; GauASCoESc = CoESfullGauASs2ic;
POTASVaRc = repmat(-VaRPOTs2i,1,N); POTASCoVaRc = CoVaRfullPOTASs2ic; POTASCoESc = CoESfullPOTASs2ic;
DCCgauVaR = -DCCVaRs2iGaufull; DCCgauCoVaR = -DCCCoVaRs2iGaufull; DCCgauCoES = -DCCCoESs2iGaufull;
DCCPOTVaR = -DCCVaRs2iPOTfull; DCCPOTCoVaR = -DCCCoVaRs2iPOTfull; DCCPOTCoES = -DCCCoESs2iPOTfull;
copulagauVaR = -CopulaVaRs2iGaufull; copulagauCoVaR = -CopulaCoVaRs2iGaufull; copulagauCoES = -CopulaCoESs2iGaufull;
copulaPOTVaR = -CopulaVaRs2iPOTfull; copulaPOTCoVaR = -CopulaCoVaRs2iPOTfull; copulaPOTCoES = -CopulaCoESs2iPOTfull;

for i = 1:N
    HitcovarGauSAV(i) = sum((hushen<-GauSAVVaR(:,i)).*(shenwan(:,i)<-GauSAVCoVaR(:,i)))/sum(hushen<-GauSAVVaR(:,i));
    HitcovarGauAS(i) = sum((hushen<-GauASVaR(:,i)).*(shenwan(:,i)<-GauASCoVaR(:,i)))/sum(hushen<-GauASVaR(:,i));
    HitcovarPOTSAV(i) = sum((hushen<-POTSAVVaR(:,i)).*(shenwan(:,i)<-POTSAVCoVaR(:,i)))/sum(hushen<-POTSAVVaR(:,i));
    HitcovarPOTAS(i) = sum((hushen<-POTASVaR(:,i)).*(shenwan(:,i)<-POTASCoVaR(:,i)))/sum(hushen<-POTASVaR(:,i));
    HitcovarGauSAVc(i) = sum((hushen<-GauASVaR(:,i)).*(shenwan(:,i)<-GauSAVCoVaRc(:,i)))/sum(hushen<-GauSAVVaRc(:,i));
    HitcovarGauASc(i) = sum((hushen<-GauASVaRc(:,i)).*(shenwan(:,i)<-GauASCoVaRc(:,i)))/sum(hushen<-GauASVaRc(:,i));
    HitcovarPOTSAVc(i) =sum((hushen<-POTSAVVaRc(:,i)).*(shenwan(:,i)<-POTSAVCoVaRc(:,i)))/sum(hushen<-POTSAVVaRc(:,i));
    HitcovarPOTASc(i) = sum((hushen<-POTASVaRc(:,i)).*(shenwan(:,i)<-POTASCoVaRc(:,i)))/sum(hushen<-POTASVaRc(:,i));
    HitcovarGumgarchg(i) = sum((hushen<-copulagauVaR(:,i,1)).*(shenwan(:,i)<-copulagauCoVaR(:,i,1)))/sum(hushen<-copulagauVaR(:,i,1));
    HitcovarTgarchg(i) = sum((hushen<-copulagauVaR(:,i,2)).*(shenwan(:,i)<-copulagauCoVaR(:,i,2)))/sum(hushen<-copulagauVaR(:,i,2));
    HitcovarGausgarchg(i) = sum((hushen<-copulagauVaR(:,i,3)).*(shenwan(:,i)<-copulagauCoVaR(:,i,3)))/sum(shenwan(:,3)<-copulagauVaR(:,i,3));
    HitcovarClaygarchg(i) = sum((hushen<-copulagauVaR(:,i,4)).*(shenwan(:,i)<-copulagauCoVaR(:,i,4)))/sum(hushen<-copulagauVaR(:,i,4));
    HitcovarGumgarchP(i) = sum((hushen<-copulaPOTVaR(:,i,1)).*(shenwan(:,i)<-copulaPOTCoVaR(:,i,1)))/sum(hushen<-copulaPOTVaR(:,i,1));
    HitcovarTgarchP(i) = sum((hushen<-copulaPOTVaR(:,i,2)).*(shenwan(:,i)<-copulaPOTCoVaR(:,i,2)))/sum(hushen<-copulaPOTVaR(:,i,2));
    HitcovarGausgarchP(i) = sum((hushen<-copulaPOTVaR(:,i,3)).*(shenwan(:,i)<-copulaPOTCoVaR(:,i,3)))/sum(hushen<-copulaPOTVaR(:,i,3));
    HitcovarClaygarchP(i) = sum((hushen<-copulaPOTVaR(:,i,4)).*(shenwan(:,i)<-copulaPOTCoVaR(:,i,4)))/sum(hushen<-copulaPOTVaR(:,i,4));
    HitcovarDCCg(i) = sum((hushen<-DCCgauVaR(:,i)).*(shenwan(:,i)<-DCCgauCoVaR(:,i)))/sum(hushen<-DCCgauVaR(:,i));
    HitcovarDCCP(i) = sum((hushen<-DCCPOTVaR(:,i)).*(shenwan(:,i)<-DCCPOTCoVaR(:,i)))/sum(hushen<-DCCPOTVaR(:,i));
end
hitcovg= [HitcovarGauSAV',HitcovarGauAS',HitcovarGauSAVc',HitcovarGauASc',HitcovarGausgarchg',HitcovarTgarchg',HitcovarClaygarchg',HitcovarGumgarchg',HitcovarDCCg'];
As2i_1 = [mean(hitcovg)*100]';
hitcovP= [HitcovarPOTSAV',HitcovarPOTAS',HitcovarPOTSAVc',HitcovarPOTASc',HitcovarGausgarchP',HitcovarTgarchP',HitcovarClaygarchP',HitcovarGumgarchP',HitcovarDCCP'];
Bs2i_1 = [mean(hitcovP)*100]';

for i = 1:N
    cccovarGauSAV(i) = cccovar(hushen,-GauSAVVaR(:,i),shenwan(:,i),-GauSAVCoVaR(:,i),THETA2);
    cccovarGauAS(i) = cccovar(hushen,-GauASVaR(:,i),shenwan(:,i),-GauASCoVaR(:,i),THETA2);
    cccovarPOTSAV(i) = cccovar(hushen,-POTSAVVaR(:,i),shenwan(:,i),-POTSAVCoVaR(:,i),THETA2);
    cccovarPOTAS(i) = cccovar(hushen,-POTASVaR(:,i),shenwan(:,i),-POTASCoVaR(:,i),THETA2);
    cccovarGauSAVc(i) = cccovar(hushen,-GauSAVVaRc(:,i),shenwan(:,i),-GauSAVCoVaRc(:,i),THETA2);
    cccovarGauASc(i) = cccovar(hushen,-GauASVaRc(:,i),shenwan(:,i),-GauASCoVaRc(:,i),THETA2);
    cccovarPOTSAVc(i) = cccovar(hushen,-POTSAVVaRc(:,i),shenwan(:,i),-POTSAVCoVaRc(:,i),THETA2);
    cccovarPOTASc(i) = cccovar(hushen,-POTASVaRc(:,i),shenwan(:,i),-POTASCoVaRc(:,i),THETA2);
    cccovarGumgarchg(i) = cccovar(hushen,-copulagauVaR(:,i,1),shenwan(:,i),-copulagauCoVaR(:,i,1),THETA2);
    cccovarTgarchg(i) = cccovar(hushen,-copulagauVaR(:,i,2),shenwan(:,i),-copulagauCoVaR(:,i,2),THETA2);
    cccovarGausgarchg(i) = cccovar(hushen,-copulagauVaR(:,i,3),shenwan(:,i),-copulagauCoVaR(:,i,3),THETA2);
    cccovarClaygarchg(i) = cccovar(hushen,-copulagauVaR(:,i,4),shenwan(:,i),-copulagauCoVaR(:,i,4),THETA2);
    cccovarGumgarchP(i) = cccovar(hushen,-copulaPOTVaR(:,i,1),shenwan(:,i),-copulaPOTCoVaR(:,i,1),THETA2);
    cccovarTgarchP(i) = cccovar(hushen,-copulaPOTVaR(:,i,2),shenwan(:,i),-copulaPOTCoVaR(:,i,2),THETA2);
    cccovarGausgarchP(i) = cccovar(hushen,-copulaPOTVaR(:,i,3),shenwan(:,i),-copulaPOTCoVaR(:,i,3),THETA2);
    cccovarClaygarchP(i) = cccovar(hushen,-copulaPOTVaR(:,i,4),shenwan(:,i),-copulaPOTCoVaR(:,i,4),THETA2);
    cccovarDCCg(i) = cccovar(hushen,-DCCgauVaR(:,i),shenwan(:,i),-DCCgauCoVaR(:,i),THETA2);
    cccovarDCCP(i) = cccovar(hushen,-DCCPOTVaR(:,i),shenwan(:,i),-DCCPOTCoVaR(:,i),THETA2);
end
cccovg= real([cccovarGauSAV',cccovarGauAS',cccovarGauSAVc',cccovarGauASc',cccovarGausgarchg',cccovarTgarchg',cccovarClaygarchg',cccovarGumgarchg',cccovarDCCg']);
cccovP= real([cccovarPOTSAV',cccovarPOTAS',cccovarPOTSAVc',cccovarPOTASc',cccovarGausgarchP',cccovarTgarchP',cccovarClaygarchP',cccovarGumgarchP',cccovarDCCP']);
As2i_23 = [sum(cccovg>0.05)',sum(cccovg>0.1)'];
Bs2i_23 = [sum(cccovP>0.05)',sum(cccovP>0.1)'];
for i = 1:N
    uccovarGauSAV(i) = uccovar(hushen,-GauSAVVaR(:,i),shenwan(:,i),-GauSAVCoVaR(:,i),THETA2);
    uccovarGauAS(i) = uccovar(hushen,-GauASVaR(:,i),shenwan(:,i),-GauASCoVaR(:,i),THETA2);
    uccovarPOTSAV(i) = uccovar(hushen,-POTSAVVaR(:,i),shenwan(:,i),-POTSAVCoVaR(:,i),THETA2);
    uccovarPOTAS(i) = uccovar(hushen,-POTASVaR(:,i),shenwan(:,i),-POTASCoVaR(:,i),THETA2);
    uccovarGauSAVc(i) = uccovar(hushen,-GauSAVVaRc(:,i),shenwan(:,i),-GauSAVCoVaRc(:,i),THETA2);
    uccovarGauASc(i) = uccovar(hushen,-GauASVaRc(:,i),shenwan(:,i),-GauASCoVaRc(:,i),THETA2);
    uccovarPOTSAVc(i) = uccovar(hushen,-POTSAVVaRc(:,i),shenwan(:,i),-POTSAVCoVaRc(:,i),THETA2);
    uccovarPOTASc(i) = uccovar(hushen,-POTASVaRc(:,i),shenwan(:,i),-POTASCoVaRc(:,i),THETA2);
    uccovarGumgarchg(i) = uccovar(hushen,-copulagauVaR(:,i,1),shenwan(:,i),-copulagauCoVaR(:,i,1),THETA2);
    uccovarTgarchg(i) = uccovar(hushen,-copulagauVaR(:,i,2),shenwan(:,i),-copulagauCoVaR(:,i,2),THETA2);
    uccovarGausgarchg(i) = uccovar(hushen,-copulagauVaR(:,i,3),shenwan(:,i),-copulagauCoVaR(:,i,3),THETA2);
    uccovarClaygarchg(i) = uccovar(hushen,-copulagauVaR(:,i,4),shenwan(:,i),-copulagauCoVaR(:,i,4),THETA2);
    uccovarGumgarchP(i) = uccovar(hushen,-copulaPOTVaR(:,i,1),shenwan(:,i),-copulaPOTCoVaR(:,i,1),THETA2);
    uccovarTgarchP(i) = uccovar(hushen,-copulaPOTVaR(:,i,2),shenwan(:,i),-copulaPOTCoVaR(:,i,2),THETA2);
    uccovarGausgarchP(i) = uccovar(hushen,-copulaPOTVaR(:,i,3),shenwan(:,i),-copulaPOTCoVaR(:,i,3),THETA2);
    uccovarClaygarchP(i) = uccovar(hushen,-copulaPOTVaR(:,i,4),shenwan(:,i),-copulaPOTCoVaR(:,i,4),THETA2);
    uccovarDCCg(i) = uccovar(hushen,-DCCgauVaR(:,i),shenwan(:,i),-DCCgauCoVaR(:,i),THETA2);
    uccovarDCCP(i) = uccovar(hushen,-DCCPOTVaR(:,i),shenwan(:,i),-DCCPOTCoVaR(:,i),THETA2);
end
uccovg= [uccovarGauSAV',uccovarGauAS',uccovarGauSAVc',uccovarGauASc',uccovarGausgarchg',uccovarTgarchg',uccovarClaygarchg',uccovarGumgarchg',uccovarDCCg'];
uccovP= [uccovarPOTSAV',uccovarPOTAS',uccovarPOTSAVc',uccovarPOTASc',uccovarGausgarchP',uccovarTgarchP',uccovarClaygarchP',uccovarGumgarchP',uccovarDCCP'];
As2i_45 = [sum(uccovg>0.05)',sum(uccovg>0.1)'];
Bs2i_45 = [sum(uccovP>0.05)',sum(uccovP>0.1)'];
for t = 1:T
    for i = 1:N
        SCoVaRGauSAV(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),GauSAVVaR(t,i),GauSAVCoVaR(t,i),THETA1test);
        SCoVaRGauAS(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),GauASVaR(t,i),GauASCoVaR(t,i),THETA1test);
        SCoVaRPOTSAV(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),POTSAVVaR(t,i),POTSAVCoVaR(t,i),THETA1test);
        SCoVaRPOTAS(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),POTASVaR(t,i),POTASCoVaR(t,i),THETA1test);
        SCoVaRGauSAVc(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),GauSAVVaRc(t,i),GauSAVCoVaRc(t,i),THETA1test);
        SCoVaRGauASc(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),GauASVaRc(t,i),GauASCoVaRc(t,i),THETA1test);
        SCoVaRPOTSAVc(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),POTSAVVaRc(t,i),POTSAVCoVaRc(t,i),THETA1test);
        SCoVaRPOTASc(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),POTASVaRc(t,i),POTASCoVaRc(t,i),THETA1test);
        SCoVaRGumg(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulagauVaR(t,i,1),copulagauCoVaR(t,i,1),THETA1test);
        SCoVaRTg(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulagauVaR(t,i,2),copulagauCoVaR(t,i,2),THETA1test);
        SCoVaRGausg(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulagauVaR(t,i,3),copulagauCoVaR(t,i,3),THETA1test);
        SCoVaRClayg(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulagauVaR(t,i,4),copulagauCoVaR(t,i,4),THETA1test);
        SCoVaRGumP(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulaPOTVaR(t,i,1),copulaPOTCoVaR(t,i,1),THETA1test);
        SCoVaRTP(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulaPOTVaR(t,i,2),copulaPOTCoVaR(t,i,2),THETA1test);
        SCoVaRGausP(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulaPOTVaR(t,i,3),copulaPOTCoVaR(t,i,3),THETA1test);
        SCoVaRClayP(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),copulaPOTVaR(t,i,4),copulaPOTCoVaR(t,i,4),THETA1test);
        SCoVaRDCCg(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),DCCgauVaR(t,i),DCCgauCoVaR(t,i),THETA1test);
        SCoVaRDCCP(t,i) = SCoVaR2(-hushen(t),-shenwan(t,i),DCCPOTVaR(t,i),DCCPOTCoVaR(t,i),THETA1test);
    end
end
As2i_6 = mean([mean(squeeze(SCoVaRGauSAV(:,:)));mean(squeeze(SCoVaRGauAS(:,:)));mean(squeeze(SCoVaRGauSAVc(:,:)));mean(squeeze(SCoVaRGauASc(:,:)));...
    mean(squeeze(SCoVaRGausg(:,:)));mean(squeeze(SCoVaRTg(:,:)));mean(squeeze(SCoVaRClayg(:,:)));mean(squeeze(SCoVaRGumg(:,:)));mean(squeeze(SCoVaRDCCg(:,:)))]*100,2);
Bs2i_6 = mean([mean(squeeze(SCoVaRPOTSAV(:,:)));mean(squeeze(SCoVaRPOTAS(:,:)));mean(squeeze(SCoVaRPOTSAVc(:,:)));mean(squeeze(SCoVaRPOTASc(:,:)));...
    mean(squeeze(SCoVaRGausP(:,:)));mean(squeeze(SCoVaRTP(:,:)));mean(squeeze(SCoVaRClayP(:,:)));mean(squeeze(SCoVaRGumP(:,:)));mean(squeeze(SCoVaRDCCP(:,:)))]*100,2);
GauAL = cat(3,SCoVaRGauSAV,SCoVaRGauAS,SCoVaRGauSAVc,SCoVaRGauASc,SCoVaRGausg,SCoVaRTg,SCoVaRClayg,SCoVaRGumg,SCoVaRDCCg);
GauALall = [];
for i = 1:N
    GauALall = cat(2,GauALall,squeeze(GauAL(:,i,:)));
end
col = {'SAV','AS','SAVc','ASc','C-Gau','C-T','C-Clay','C-RGum','DCC'};
colall = [];
for i = 1:N
    for j = 1:9
        colall = cat(2,colall,strcat(col(j),num2str(i)));
    end
end
columns = repmat(col,1,31);
data = array2table(GauALall,'VariableNames',colall);
writetable(data, 'E:\software\R\code\CoVaRCoes\Gaus2ifullCoVaR.csv');

POTAL = cat(3,SCoVaRPOTSAV,SCoVaRPOTAS,SCoVaRPOTSAVc,SCoVaRPOTASc,SCoVaRGausP,SCoVaRTP,SCoVaRClayP,SCoVaRGumP,SCoVaRDCCP);
POTALall = [];
for i = 1:N
    POTALall = cat(2,POTALall,squeeze(POTAL(:,i,:)));
end
col = {'SAV','AS','SAVc','ASc','C-Gau','C-T','C-Clay','C-RGum','DCC'};
colall = [];
for i = 1:N
    for j = 1:9
        colall = cat(2,colall,strcat(col(j),num2str(i)));
    end
end
columns = repmat(col,1,31);
data = array2table(POTALall,'VariableNames',colall);
writetable(data, 'E:\software\R\code\CoVaRCoes\POTs2ifullCoVaR.csv');

%%     Table 3  column 1-6
% Panel A Industries → System
[Ai2s_1,Ai2s_23,Ai2s_45,Ai2s_6]
% Panel A System → Industries
[As2i_1,As2i_23,As2i_45,As2i_6]
% Panel B Industries → System
[Bi2s_1,Bi2s_23,Bi2s_45,Bi2s_6]
% Panel B System → Industries
[Bs2i_1,Bs2i_23,Bs2i_45,Bs2i_6]


%%      Table 3  column 7-8 is generated by R (code name: A_Table3_2.R)
